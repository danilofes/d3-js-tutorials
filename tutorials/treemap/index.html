<!DOCTYPE html><html><head><meta charset="utf-8"><style>body {
  width: 45em;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 30px;
}

@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #fff;
}

.markdown-body .highlight .h {
  color: #333;
  font-style: normal;
  font-weight: normal;
}

.markdown-body .highlight .mf,
.markdown-body .highlight .mh,
.markdown-body .highlight .mi,
.markdown-body .highlight .mo,
.markdown-body .highlight .il,
.markdown-body .highlight .m {
  color: #945277;
}

.markdown-body .highlight .s,
.markdown-body .highlight .sb,
.markdown-body .highlight .sc,
.markdown-body .highlight .sd,
.markdown-body .highlight .s2,
.markdown-body .highlight .se,
.markdown-body .highlight .sh,
.markdown-body .highlight .si,
.markdown-body .highlight .sx,
.markdown-body .highlight .s1 {
  color: #df5000;
}

.markdown-body .highlight .kc,
.markdown-body .highlight .kd,
.markdown-body .highlight .kn,
.markdown-body .highlight .kp,
.markdown-body .highlight .kr,
.markdown-body .highlight .kt,
.markdown-body .highlight .k,
.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #458;
}

.markdown-body .highlight .c,
.markdown-body .highlight .cm,
.markdown-body .highlight .c1 {
  color: #998;
  font-style: italic;
}

.markdown-body .highlight .cp,
.markdown-body .highlight .cs,
.markdown-body .highlight .cp .h {
  color: #999;
  font-weight: bold;
}

.markdown-body .highlight .cs {
  font-style: italic;
}

.markdown-body .highlight .n {
  color: #333;
}

.markdown-body .highlight .na,
.markdown-body .highlight .nv,
.markdown-body .highlight .vc,
.markdown-body .highlight .vg,
.markdown-body .highlight .vi {
  color: #008080;
}

.markdown-body .highlight .nb {
  color: #0086B3;
}

.markdown-body .highlight .nc {
  color: #458;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: #094e99;
}

.markdown-body .highlight .ni {
  color: #800080;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #945277;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555;
}

.markdown-body .highlight .nt {
  color: #000080;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .gd {
  color: #000;
  background-color: #fdd;
}

.markdown-body .highlight .gd .x {
  color: #000;
  background-color: #faa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999;
}

.markdown-body .highlight .gi {
  color: #000;
  background-color: #dfd;
}

.markdown-body .highlight .gi .x {
  color: #000;
  background-color: #afa;
}

.markdown-body .highlight .go {
  color: #888;
}

.markdown-body .highlight .gp {
  color: #555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbb;
}

.markdown-body .highlight .sr {
  color: #017936;
}

.markdown-body .highlight .ss {
  color: #8b467f;
}

.markdown-body .highlight .bp {
  color: #999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #000;
  border: 1px solid #cfcfcf;
  border-radius: 2px;
}

.markdown-body .highlight .pl-coc,
.markdown-body .highlight .pl-entm,
.markdown-body .highlight .pl-eoa,
.markdown-body .highlight .pl-mai .pl-sf,
.markdown-body .highlight .pl-pdv,
.markdown-body .highlight .pl-sc,
.markdown-body .highlight .pl-sr,
.markdown-body .highlight .pl-v,
.markdown-body .highlight .pl-vpf {
  color: #0086b3;
}

.markdown-body .highlight .pl-eoac,
.markdown-body .highlight .pl-mdht,
.markdown-body .highlight .pl-mi1,
.markdown-body .highlight .pl-mri,
.markdown-body .highlight .pl-va,
.markdown-body .highlight .pl-vpu {
  color: #008080;
}

.markdown-body .highlight .pl-c,
.markdown-body .highlight .pl-pdc {
  color: #b4b7b4;
  font-style: italic;
}

.markdown-body .highlight .pl-k,
.markdown-body .highlight .pl-ko,
.markdown-body .highlight .pl-kolp,
.markdown-body .highlight .pl-mc,
.markdown-body .highlight .pl-mr,
.markdown-body .highlight .pl-ms,
.markdown-body .highlight .pl-s,
.markdown-body .highlight .pl-sok,
.markdown-body .highlight .pl-st {
  color: #6e5494;
}

.markdown-body .highlight .pl-ef,
.markdown-body .highlight .pl-enf,
.markdown-body .highlight .pl-enm,
.markdown-body .highlight .pl-entc,
.markdown-body .highlight .pl-eoi,
.markdown-body .highlight .pl-sf,
.markdown-body .highlight .pl-smc {
  color: #d12089;
}

.markdown-body .highlight .pl-ens,
.markdown-body .highlight .pl-eoai,
.markdown-body .highlight .pl-kos,
.markdown-body .highlight .pl-mh .pl-pdh,
.markdown-body .highlight .pl-mp,
.markdown-body .highlight .pl-pde,
.markdown-body .highlight .pl-stp {
  color: #458;
}

.markdown-body .highlight .pl-enti {
  color: #d12089;
  font-weight: bold;
}

.markdown-body .highlight .pl-cce,
.markdown-body .highlight .pl-enc,
.markdown-body .highlight .pl-kou,
.markdown-body .highlight .pl-mq {
  color: #f93;
}

.markdown-body .highlight .pl-mp1 .pl-sf {
  color: #458;
  font-weight: bold;
}

.markdown-body .highlight .pl-cos,
.markdown-body .highlight .pl-ent,
.markdown-body .highlight .pl-md,
.markdown-body .highlight .pl-mdhf,
.markdown-body .highlight .pl-ml,
.markdown-body .highlight .pl-pdc1,
.markdown-body .highlight .pl-pds,
.markdown-body .highlight .pl-s1,
.markdown-body .highlight .pl-scp,
.markdown-body .highlight .pl-sol {
  color: #df5000;
}

.markdown-body .highlight .pl-c1,
.markdown-body .highlight .pl-cn,
.markdown-body .highlight .pl-pse,
.markdown-body .highlight .pl-pse .pl-s2,
.markdown-body .highlight .pl-vi {
  color: #a31515;
}

.markdown-body .highlight .pl-mb,
.markdown-body .highlight .pl-pdb {
  color: #df5000;
  font-weight: bold;
}

.markdown-body .highlight .pl-mi,
.markdown-body .highlight .pl-pdi {
  color: #6e5494;
  font-style: italic;
}

.markdown-body .highlight .pl-ms1 {
  background-color: #f5f5f5;
}

.markdown-body .highlight .pl-mdh,
.markdown-body .highlight .pl-mdi {
  font-weight: bold;
}

.markdown-body .highlight .pl-mdr {
  color: #0086b3;
  font-weight: bold;
}

.markdown-body .highlight .pl-s2 {
  color: #333;
}

.markdown-body .highlight .pl-ii {
  background-color: #df5000;
  color: #fff;
}

.markdown-body .highlight .pl-ib {
  background-color: #f93;
}

.markdown-body .highlight .pl-id {
  background-color: #a31515;
  color: #fff;
}

.markdown-body .highlight .pl-iu {
  background-color: #b4b7b4;
}

.markdown-body .highlight .pl-mo {
  color: #969896;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  float: left;
  margin: 0.3em 0 0.25em -1.6em;
  vertical-align: middle;
}</style><title>README</title></head><body><article class="markdown-body"><h1>
<a id="user-content-treemap" class="anchor" href="#treemap" aria-hidden="true"><span class="octicon octicon-link"></span></a>Treemap</h1>

<p>Neste tutorial vamos ensinar os conceitos necessários para construir uma visualização Treemap.
Esse tipo de visualização é apropriada para representar o relacionamento parte/todo quando os dados
possuem uma estrutura hierárquica.
Um Treemap divide a área recursivamente em retângulos, de forma que a área de cada retângulo corresponda ao valor do dado associado, conforme exemplificado na figura abaixo:</p>

<p><a href="///C://Users/danilofs/git/d3-js-tutorials/tutorials/treemap/treemap-example.png" target="_blank"><img src="///C://Users/danilofs/git/d3-js-tutorials/tutorials/treemap/treemap-example.png" alt="Exemplo de Treemap" style="max-width:100%;"></a></p>

<p>Antes de prosseguir, vale ressaltar que assumimos um conhecimento básico dos seguintes tópicos:</p>

<ul>
<li>Programação em Javascript</li>
<li>HTML e o padrão de desenho vetorial SVG</li>
<li>Estilos CSS</li>
</ul>

<p>Caso o leitor não conheça nada sobre algum dos itens acima, recomendamos que procure primeiro outros materiais introdutórios
nos respectivos assuntos. No entanto, nenhum conhecimento em detalhes é exigido para acompanhar este tutorial.  </p>

<h2>
<a id="user-content-dados-de-exemplo" class="anchor" href="#dados-de-exemplo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dados de Exemplo</h2>

<p>Antes de começar nosso tutorial, primeiro precisamos de dados. 
Vamos imaginar que estamos interessados em controlar as despesas mensais e saber com que tipo
de coisa gastamos mais dinheiro. Supondo que uma certa pessoa registrou todas as despesas do mês e as organizou em uma hierarquia de categorias, podemos ter dados como exemplificado abaixo.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> expenses <span class="pl-k">=</span> {
  <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Despesas Totais<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>subitens<span class="pl-pds">"</span></span><span class="pl-k">:</span> [{
    <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Água<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">67.00</span>
  },{
    <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Energia<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">112.00</span>
  },{
    <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Aluguel<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">900.00</span>
  },{
    <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Alimentação<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>subitens<span class="pl-pds">"</span></span><span class="pl-k">:</span> [{
      <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Almoço no RU<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">84.00</span>
    },{
      <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Compra do mês<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">316.00</span>
    }]
  },{
    <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Transporte<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>subitens<span class="pl-pds">"</span></span><span class="pl-k">:</span> [{
      <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Gasolina<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">250.00</span>
    },{
      <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Troca de Óleo<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">120.00</span>
    },{
      <span class="pl-s"><span class="pl-pds">"</span>categoria<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Ônibus<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>valor<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">26.40</span>
    }]
  }]
};</pre></div>

<p>Os dados acima estão na notação JSON. Uma característica importante é que eles são organizados em uma hierárquia e apenas os nodos folha possuem valores. O valor dos nodos internos correspondem à soma dos valores de seus descendentes. Com isso, a visualização em Treemap é interessante para visualizar as despesas.</p>

<h2>
<a id="user-content-construindo-um-treemap-básico" class="anchor" href="#construindo-um-treemap-b%C3%A1sico" aria-hidden="true"><span class="octicon octicon-link"></span></a>Construindo um Treemap Básico</h2>

<p>Para começar a construir nossa visualização, vamos partir de uma página HTML simples, como exemplificada abaixo:</p>

<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">html</span>&gt;
&lt;<span class="pl-ent">head</span>&gt;
&lt;<span class="pl-ent">title</span>&gt;Treemap&lt;/<span class="pl-ent">title</span>&gt;
&lt;<span class="pl-ent">meta</span> <span class="pl-e">http-equiv</span>=<span class="pl-s"><span class="pl-pds">"</span>Content-Type<span class="pl-pds">"</span></span> <span class="pl-e">content</span>=<span class="pl-s"><span class="pl-pds">"</span>text/html;charset=utf-8<span class="pl-pds">"</span></span>&gt;
&lt;/<span class="pl-ent">head</span>&gt;
&lt;<span class="pl-ent">body</span>&gt;

&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>../../lib/d3.v3.min.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;
<span class="pl-s1">&lt;<span class="pl-ent">script</span>&gt;</span>
<span class="pl-s1"><span class="pl-c">// aqui será feito o código</span></span>
<span class="pl-s1">&lt;/<span class="pl-ent">script</span>&gt;</span>

&lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>

<p>No código acima, temos a estrutura mínima de um documento HTML. Observe que importamos um arquivo Javascript, que é a própria bilioteca D3.js. Em seguinda, temos um tag SCRIPT que conterá o código que iremos desenvolver nos passos seguintes.</p>

<h3>
<a id="user-content-usando-layouts" class="anchor" href="#usando-layouts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usando Layouts</h3>

<p>A API D3 nos provê diversas facilidades para implementar visualizações. Uma dessas facilidades é o conceito de Layouts. Um layout é um objeto responsável por computar as posições e dimensões de cada nodo de um conjunto de dados (veja <a href="https://github.com/mbostock/d3/wiki/Layouts">https://github.com/mbostock/d3/wiki/Layouts</a>). No caso do Treemap, existe a função <code>d3.layout.treemap()</code>, que nos retorna um objeto que representa o layout de Treemap. Portanto, vamos iniciar nosso código criando esse objeto:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> treemapLayout <span class="pl-k">=</span> d3.layout.treemap();</pre></div>

<p>O layout Treemap precisa de conhecer as dimensões da área total disponível para conseguir calcular a posição dos elementos. Para isso, devemos usar o método <code>treemapLayout.size([width, height])</code>, onde <code>width</code> e <code>height</code> são a largura e altura em pixels da área disponível. Além disso, o layout Treemap precisa saber como interpretar nossos dados. Especificamente, devemos fornecer ao layout funções para acessar o valor de um nodo e também os seus nodos filhos. Isso é configurado com as funções <code>treemapLayout.value</code> e <code>treemapLayout.children</code>. É importante ressaltar que existem diversas outras configurações opcionais que 
podemos passar para o Treemap layout (mais detalhes em <a href="https://github.com/mbostock/d3/wiki/Treemap-Layout#treemap">https://github.com/mbostock/d3/wiki/Treemap-Layout#treemap</a>).
Para nosso exemplo, a configuração ficaria como a abaixo:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> width <span class="pl-k">=</span> <span class="pl-c1">600</span>;
<span class="pl-k">var</span> height <span class="pl-k">=</span> <span class="pl-c1">400</span>;
<span class="pl-k">var</span> treemapLayout <span class="pl-k">=</span> d3.layout.treemap();

treemapLayout.<span class="pl-c1">size</span>([width, height]);

treemapLayout.<span class="pl-c1">value</span>(<span class="pl-k">function</span>(<span class="pl-smi">node</span>) {
  <span class="pl-k">return</span> node.valor;
});

treemapLayout.children(<span class="pl-k">function</span>(<span class="pl-smi">node</span>) {
  <span class="pl-k">return</span> node.subitens;
});</pre></div>

<p>Feita essas configurações, já podemos usar o layout para computar as posições e dimensões de cada elemento usando a função <code>treemapLayout.nodes</code>, passando como parâmetro os nossos dados:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> nodes <span class="pl-k">=</span> treemapLayout.nodes(expenses);</pre></div>

<p>Se inspecionarmos o resultado dessa chamada, veremos que ela retorna um vetor com um elemento para cada nodo dos nossos dados, onde cada elemento possui os dados abaixo:</p>

<div class="highlight highlight-javascript"><pre>{
  categoria<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Alimentação<span class="pl-pds">"</span></span>,
  subitens<span class="pl-k">:</span> ...
  x<span class="pl-k">:</span> <span class="pl-c1">184</span>,
  y<span class="pl-k">:</span> <span class="pl-c1">0</span>,
  dx<span class="pl-k">:</span> <span class="pl-c1">416</span>,
  dy<span class="pl-k">:</span> <span class="pl-c1">123</span>,
  value<span class="pl-k">:</span> <span class="pl-c1">400</span>,
  area<span class="pl-k">:</span> <span class="pl-c1">51189.07966300523</span>,
  ...
}</pre></div>

<p>Observe que, além dos campos que já existiam no JSON original, o layout adiciona nos elementos do vetor os valores computados para a posição (<code>x</code> e <code>y</code>) e a largura e altura do nodo (<code>dx</code> e <code>dy</code>), de acordo com o algoritmo do Treemap.
Concluindo, um layout nos ajuda a preparar os dados para exibição, mas não é responsável por exibí-los. Evidentemente, podemos implementar nossa própria lógica para computar as posições em vez de usar layouts prontos disponíveis no D3.</p>

<h3>
<a id="user-content-criando-os-elementos-visuais" class="anchor" href="#criando-os-elementos-visuais" aria-hidden="true"><span class="octicon octicon-link"></span></a>Criando os Elementos Visuais</h3>

<p>Para de fato desenhar os retângulos do Treemap, vamos criar novas tags no corpo da nossa página. A manipulação do DOM (Document Object Model) é feita no D3 usando um estilo parecido com a popular API JQuery. Ou seja, selecionamos um conjunto de elementos e trabalhamos nessa seleção encadeando chamadas de funções. No entanto, o D3 introduz um conceito novo, denominado <em>data joins</em>. É importante entender esse conceito para se trabalhar com o D3. Uma introdução ao assunto pode ser encontrada em <a href="http://bost.ocks.org/mike/join/">http://bost.ocks.org/mike/join/</a> .</p>

<p>Antes de criar os retângulos, precisamos criar um contâiner para eles:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> svgTag <span class="pl-k">=</span> d3.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">"</span>body<span class="pl-pds">"</span></span>).append(<span class="pl-s"><span class="pl-pds">"</span>svg<span class="pl-pds">"</span></span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>treemap<span class="pl-pds">"</span></span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>width<span class="pl-pds">"</span></span>, width <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>px<span class="pl-pds">"</span></span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>height<span class="pl-pds">"</span></span>, height <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>px<span class="pl-pds">"</span></span>);</pre></div>

<p>No código acima, selecionamos o corpo da página usando a função <code>d3.select</code>. Em seguida, adicionamos uma nova tag do tipo SVG dentro da seleção resultante por meio da chamada ao método <code>append</code>. A partir daí, a seleção resultante passa a ser a tag SVG. Em seguida encadeamos três chamadas à função <code>attr</code>. Essa função define o valor de um atributo para os elementos da seleção. Observe que tal função sempre retorna a própria seleção alvo da chamada. Dessa forma, definimos os atributos <code>class</code>, <code>width</code> e <code>height</code> da tag SVG que criamos.</p>

<p>Vamos agora criar elementos RECT, dentro do container SVG, para cada nodo de dados:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> rects <span class="pl-k">=</span> svgTag.selectAll(<span class="pl-s"><span class="pl-pds">"</span>rect<span class="pl-pds">"</span></span>).<span class="pl-c1">data</span>(nodes)

rects.enter().append(<span class="pl-s"><span class="pl-pds">"</span>rect<span class="pl-pds">"</span></span>);

rects
  .attr(<span class="pl-s"><span class="pl-pds">"</span>x<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.<span class="pl-c1">x</span>;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>y<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.<span class="pl-c1">y</span>;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>width<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dx;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>height<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dy;});</pre></div>

<p>Vamos analisar em detalhes o código acima. Primeiro, <code>svgTag.selectAll("rect")</code> seleciona todos as tags RECT dentro da tag SVG. Alguém poderia se perguntar porque fazer isso, se sabemos que não existem elementos RECT ainda.
Na verdade, nossa intenção é mapear tags da página aos nodos de dados correspondentes (ou seja, fazer um <em>data joins</em>), o que ocorre na chamada <code>.data(nodes)</code> que vem em seguida. Essa chamada gerará três seleções de elementos que representam 
três estados possíveis (mais detalhes em <a href="http://bl.ocks.org/mbostock/3808218">http://bl.ocks.org/mbostock/3808218</a>):</p>

<ul>
<li>
<em>enter</em>: representa os dados novos para os quais não existem tags correspondentes na página. No nosso caso, a página estava vazia e todos os dados cairão nessa seleção.</li>
<li>
<em>update</em>: representa as tags existentes que foram mapeadas para um nodo de dados. Essa seleção estará vazia. </li>
<li>
<em>exit</em>: representa as tags existentes para as quais não há dados. Essa seleção estará vazia também. Ela só existirá quando houver mais tags do que dados no <em>join</em>.</li>
</ul>

<p>A chamada <code>rects.enter()</code> nos permite especificar exatamente o que fazer para a seleção <em>enter</em>. No caso, o que queremos é criar a tag RECT para cada nodo do dados.  </p>

<p>Em seguida, usamos a seleção <code>rects</code>, que agora corresponde à união das seleções <em>enter</em> e <em>update</em>, para atualizar os atributos da tag RECT de acordo com os dados. Isso é feito com várias chamadas a função <code>attr</code>, como de costume. No entanto, há uma novidade nessas chamadas. Em vez de passar um valor como segundo parâmetro, estamos passando uma função. Essa função recebe como parâmetro o nodo de dado associado a tag, e podemos usá-lo para obter os valores de <code>x</code>, <code>y</code>, <code>dx</code> e <code>dy</code>.</p>

<p>Para finalizar nosso Treemap básico, vamos definir a borda e cor de preenchimento dos retângulos via estilos CSS:</p>

<div class="highlight highlight-css"><pre><span class="pl-e">.treemap</span> rect {
  <span class="pl-c1"><span class="pl-c1">fill</span></span>: <span class="pl-c1">#cccccc</span>;
  <span class="pl-c1">stroke</span>: <span class="pl-c1">black</span>;
  <span class="pl-c1">stroke-<span class="pl-c1">width</span></span>: <span class="pl-c1">1</span>;
}</pre></div>

<p>Pronto! Eis o resultado:</p>

<p><a href="///C://Users/danilofs/git/d3-js-tutorials/tutorials/treemap/treemap-basic.png" target="_blank"><img src="///C://Users/danilofs/git/d3-js-tutorials/tutorials/treemap/treemap-basic.png" alt="Treemap Básico" style="max-width:100%;"></a></p>

<h2>
<a id="user-content-adicionando-rótulos-e-cores" class="anchor" href="#adicionando-r%C3%B3tulos-e-cores" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adicionando Rótulos e Cores</h2>

<p>Até agora conseguimos desenhar os retângulos nas posições corretas e com o tamanho desejado. Porém, nossa visualização
ainda tem problemas óbvios como:</p>

<ul>
<li>Não sabemos o que cada retângulo representa.</li>
<li>Não temos noção da hierarquia de categorias.</li>
</ul>

<p>Para melhorar nosso Treemap, vamos começar adicionando rótulos para identificar os retângulos. Para isso, podemos criar elementos
da seguinte maneira. Criamos um tag G, que representa um grupo de tags, para cada nodo dos dados e dentro dela criamos a tag RECT para o retângulo e uma ou mais tags TEXT para imprimir rótulos. O código reestruturado ficará como o abaixo:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> groups <span class="pl-k">=</span> svgTag.selectAll(<span class="pl-s"><span class="pl-pds">"</span>g<span class="pl-pds">"</span></span>).<span class="pl-c1">data</span>(nodes).enter().append(<span class="pl-s"><span class="pl-pds">"</span>g<span class="pl-pds">"</span></span>);

groups
  .attr(<span class="pl-s"><span class="pl-pds">"</span>transform<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>translate(<span class="pl-pds">"</span></span> <span class="pl-k">+</span> d.<span class="pl-c1">x</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span> <span class="pl-k">+</span> d.<span class="pl-c1">y</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>)<span class="pl-pds">"</span></span>;});

groups.append(<span class="pl-s"><span class="pl-pds">"</span>rect<span class="pl-pds">"</span></span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>width<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dx;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>height<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dy;});

groups.append(<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>x<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dx/<span class="pl-c1">2</span>;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>y<span class="pl-pds">"</span></span>, <span class="pl-c1">16</span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>text-anchor<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>middle<span class="pl-pds">"</span></span>)
  .<span class="pl-c1">text</span>(<span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.categoria;});

groups.append(<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>x<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dx/<span class="pl-c1">2</span>;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>y<span class="pl-pds">"</span></span>, <span class="pl-c1">32</span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>text-anchor<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>middle<span class="pl-pds">"</span></span>)
  .<span class="pl-c1">text</span>(<span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>R$ <span class="pl-pds">"</span></span> <span class="pl-k">+</span> d.<span class="pl-c1">value</span>.toFixed(<span class="pl-c1">2</span>);});</pre></div>

<p>Observe que a tag G possui o atributo <code>transform</code> para aplicar uma translação em todos os elementos contidos no mesmo, para evitar de repetir as posições <code>x</code> e <code>y</code> do nodo em cada tag. 
Além disso, observe que criamos dois rótulos, um para exibir a categoria e outro para imprimir o valor. Ambos estão posicionados no centro do retângulo, a uma distância fixa do topo.</p>

<p>Por padrão, as areas das categorias filhas sobrepõem totalmente a área da categoria pai. Para permitir que o aninhamento seja visível, vamos adicionar uma margem usando a configuração <code>padding</code> do layout Treemap:</p>

<div class="highlight highlight-javascript"><pre>treemapLayout.padding([<span class="pl-c1">38</span>, <span class="pl-c1">8</span>, <span class="pl-c1">8</span>, <span class="pl-c1">8</span>]);</pre></div>

<p>A margem de topo foi definida de forma a dar espaço para exibição do rótulo (38 pixels) e as demais margens foram definidas como 8 pixels.</p>

<p>Por fim, vamos atribuir uma cor de fundo diferente para cada retângulo, tornando mais fácil a distinção entre eles. Para isso, vamos fazer um mapeamento simples do índice de um nodo de dados em uma cor no espaço HSL:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> <span class="pl-en">colorScale</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">i</span>) {
  <span class="pl-k">var</span> step <span class="pl-k">=</span> <span class="pl-c1">256</span>/nodes.<span class="pl-c1">length</span>;
  <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>hsl(<span class="pl-pds">"</span></span> <span class="pl-k">+</span> i <span class="pl-k">*</span> step <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>, 80%, 70%)<span class="pl-pds">"</span></span>;
}; </pre></div>

<p>Esta função recebe um índice <code>i</code> e retorna uma cor. O índice é usado para escolher o valor da componente <em>hue</em>, que é um valor entre 0 e 255. Os valores de <em>saturation</em> e <em>lightness</em> são fixos para que as cores sejam harmoniosas com a cor da fonte.
Agora, basta definir o atributo <code>fill</code> do retângulo usando nossa escala de cores:</p>

<div class="highlight highlight-javascript"><pre>groups.append(<span class="pl-s"><span class="pl-pds">"</span>rect<span class="pl-pds">"</span></span>)
  .attr(<span class="pl-s"><span class="pl-pds">"</span>width<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dx;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>height<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {<span class="pl-k">return</span> d.dy;})
  .attr(<span class="pl-s"><span class="pl-pds">"</span>fill<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>, <span class="pl-smi">i</span>) {<span class="pl-k">return</span> colorScale(i);});</pre></div>

<p>Por fim, precisamos de algumas adaptações no estilo pois não queremos mais definir uma cor de fundo cinza. Além disso, precisamos de alguns ajustes na fonte:</p>

<div class="highlight highlight-css"><pre><span class="pl-e">.treemap</span> rect {
  <span class="pl-c1">stroke</span>: <span class="pl-c1">black</span>;
  <span class="pl-c1">stroke-<span class="pl-c1">width</span></span>: <span class="pl-c1">1</span>;
}
<span class="pl-e">.treemap</span> text {
  <span class="pl-c1"><span class="pl-c1">font-family</span></span>: <span class="pl-c1">Arial</span>;
  <span class="pl-c1"><span class="pl-c1">font-size</span></span>: <span class="pl-c1">12<span class="pl-k">px</span></span>;
}</pre></div>

<p>Pronto, eis o resultado final:</p>

<p><a href="///C://Users/danilofs/git/d3-js-tutorials/tutorials/treemap/treemap-complete.png" target="_blank"><img src="///C://Users/danilofs/git/d3-js-tutorials/tutorials/treemap/treemap-complete.png" alt="Treemap Básico" style="max-width:100%;"></a></p>

<p>Agora sim podemos analisar o dados e derivar conclusões. Por exemplo, fica nítido que o aluguel é a principal despesa. Transporte e alimentação possuem pesos similares, enquanto água e luz possuem pouco impacto nas despesas totais.
O código completo desenvolvido nesse tutorial pode ser encontrado <a href="///C://Users/danilofs/git/d3-js-tutorials/tutorials/treemap/treemap.html">aqui</a>.</p>
</article></body></html>